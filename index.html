<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paseando Madrid</title>

  <meta name="description" content="Free tours culturales en Madrid para descubrir la historia, el arte y la vida de la ciudad paso a paso. Paseos guiados donde la ciudad forma parte del camino." />

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>

  <!-- HEADER -->
  <header class="site-header" id="inicio">
    <div class="container header-inner">

      <a class="brand" href="#inicio" aria-label="Paseando Madrid, inicio">
        <span class="brand-mark" aria-hidden="true"></span>
        <span class="brand-word">Paseando Madrid</span>
      </a>

      <nav class="site-nav" aria-label="Navegación principal">
        <a class="nav-link" href="#inicio">Inicio</a>
        <a class="nav-link" href="#free-tours">Free tours</a>
        <a class="nav-link" href="#tours-a-medida">Tours a medida</a>
        <a class="nav-link" href="#quienes">Quiénes somos</a>
        <a class="nav-link" href="#que-hacer">Qué hacer en Madrid</a>
        <a class="nav-link" href="#contacto">Contacto</a>
      </nav>

    </div>
  </header>

  <main>

    <!-- HERO VIDEO -->
    <section class="home-hero" aria-label="Hero">
      <div class="hero-frame hero-frame--full">

        <video
          class="hero-video"
          autoplay
          muted
          loop
          playsinline
          preload="metadata"
          aria-hidden="true"
        >
          <source src="assets/video/hero.mp4" type="video/mp4" />
        </video>

        <div class="hero-overlay" aria-hidden="true"></div>

        <div class="container">
          <div class="hero-copy">

            <h1 class="hero-title">
              Madrid, contada paso a paso.
            </h1>

            <p class="hero-subtitle">
              Free tours culturales para hacer de la ciudad parte del camino,
              entre historia, arte y vida.
            </p>

            <div class="hero-actions">
              <a class="hero-cta" href="#free-tours">Comenzar el paseo →</a>
              <a class="hero-cta hero-cta--ghost" href="#que-hacer">Qué hacer en Madrid →</a>
            </div>

            <!-- PRUEBA SOCIAL -->
            <p class="hero-proof" aria-label="Valoración de opiniones">
              <em>Lo que dicen de nosotros</em>
              <span class="hero-proof-sep" aria-hidden="true">·</span>
              <span class="hero-proof-star" aria-hidden="true">★</span>
              <strong class="hero-proof-score">4.9</strong>
              <a class="hero-proof-link" href="#opiniones">Ver opiniones</a>
            </p>

          </div>
        </div>

      </div>
    </section>

    <!-- FREE TOURS -->
    <section class="section" id="free-tours" aria-label="Free tours">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">Free tours</h2>
          <p class="section-lead">
            Aquí irá la sección de familias (carruseles) en el siguiente paso.
          </p>
        </div>

        <div class="placeholder">
          <p><strong>OK:</strong> si ves esto al bajar, el hero + header están bien.</p>
        </div>
      </div>
    </section>

    <!-- TOURS A MEDIDA -->
    <section class="section section-soft" id="tours-a-medida" aria-label="Tours a medida">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">Tours a medida</h2>
          <p class="section-lead">Placeholder para mantener estructura.</p>
        </div>

        <div class="placeholder">
          <p>Contenido a medida aquí.</p>
        </div>
      </div>
    </section>

    <!-- QUIÉNES SOMOS -->
    <section class="section" id="quienes" aria-label="Quiénes somos">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">Quiénes somos</h2>
          <p class="section-lead">Placeholder para mantener estructura.</p>
        </div>

        <div class="placeholder">
          <p>Texto editorial + foto (opcional) aquí.</p>
        </div>
      </div>
    </section>

    <!-- OPINIONES -->
    <section class="section" id="opiniones" aria-label="Opiniones">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">Opiniones</h2>
          <p class="section-lead">Aquí mostraremos reseñas reales (Google/Tripadvisor) con diseño editorial.</p>
        </div>

        <div class="placeholder">
          <p>Bloque de reseñas aquí.</p>
        </div>
      </div>
    </section>

    <!-- QUÉ HACER EN MADRID (HERO EDITORIAL MARFIL) -->
    <section class="section section-ivory section-quehacer" id="que-hacer" aria-label="Qué hacer en Madrid">
      <div class="container quehacer-inner">

        <!-- Tipografía fondo (arriba derecha) -->
        <div class="cooltura" aria-hidden="true">
          <span class="cooltura-cool">Cool</span><span class="cooltura-tura">tura</span>
        </div>

        <div class="section-head section-head--tight">
          <h2 class="section-title">Qué hacer en Madrid</h2>
          <p class="section-lead">Seis puertas, una selección cultural. Abre una y descubre.</p>
        </div>

        <!-- Mosaic flotante -->
        <div class="k-mosaic" id="kMosaic" aria-label="Selección de tarjetas">

          <!-- Cartelera (GRANDE) -->
          <button class="k-card k-card--cartelera" type="button" data-open="cartelera" aria-label="Cartelera">
            <div class="k-media k-media--tall" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>Cartelera</strong></span>
          </button>

          <!-- En directo (GRANDE DOMINANTE) -->
          <button class="k-card k-card--directo" type="button" data-open="directo" aria-label="En directo">
            <div class="k-media k-media--tall" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>En directo</strong></span>
          </button>

          <!-- Con niños (MEDIA) -->
          <button class="k-card k-card--ninos" type="button" data-open="ninos" aria-label="Con niños">
            <div class="k-media k-media--wide" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>Con niños</strong></span>
          </button>

          <!-- Museo (PEQUEÑA) -->
          <button class="k-card k-card--museo" type="button" data-open="museo" aria-label="Museo">
            <div class="k-media k-media--square" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>Museo</strong></span>
          </button>

          <!-- Expos (MINI pegada a vértice) -->
          <button class="k-card k-card--expos" type="button" data-open="expos" aria-label="Expos">
            <div class="k-media k-media--mini" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>Expos</strong></span>
          </button>

          <!-- Alarga el paseo (PEQUEÑA) -->
          <button class="k-card k-card--alarga" type="button" data-open="alarga" aria-label="Alarga el paseo">
            <div class="k-media k-media--square" aria-hidden="true">
              <span class="k-ph">Foto</span>
            </div>
            <span class="k-name"><strong>Alarga el paseo</strong></span>
          </button>

        </div>
      </div>
    </section>

  </main>

  <!-- CONTACTO -->
  <footer class="footer" id="contacto" aria-label="Contacto">
    <div class="container footer-inner">
      <p class="footer-brand">Paseando Madrid</p>
      <p class="footer-note">
        Contacto: <a href="mailto:info@paseandomadrid.com">info@paseandomadrid.com</a>
      </p>
    </div>
  </footer>

  <!-- OVERLAY / MODAL (editorial) -->
  <div class="k-modal" id="kModal" aria-hidden="true">
    <div class="k-backdrop" data-close></div>

    <article class="k-sheet" role="dialog" aria-modal="true" aria-label="Información">
      <button class="k-close" type="button" data-close aria-label="Cerrar">×</button>

      <header class="k-head">
        <p class="k-kicker">Qué hacer en Madrid</p>
        <h3 class="k-title" id="kTitle">—</h3>
        <p class="k-deck" id="kDeck">—</p>
        <p class="k-meta" id="kMeta">—</p>
      </header>

      <div class="k-body">
        <div class="k-list" id="kList"></div>
      </div>
    </article>
  </div>

  <!-- JS: overlay + carga JSON -->
  <script>
    const modal = document.getElementById('kModal');
    const kTitle = document.getElementById('kTitle');
    const kDeck  = document.getElementById('kDeck');
    const kMeta  = document.getElementById('kMeta');
    const kList  = document.getElementById('kList');

    const CFG = {
      directo: {
        title: "Conciertos esta semana",
        deck: "Una selección breve para escuchar Madrid en directo.",
        json: "data/agenda-weekly.json",
        mode: "items"
      },
      ninos: {
        title: "Disfrutar Madrid con niños",
        deck: "Planes culturales y fáciles para hacerlo con ellos esta semana.",
        json: "data/kids-weekly.json",
        mode: "items"
      },
      expos: {
        title: "Exposiciones de este mes",
        deck: "Salas, museos y montajes que merecen la visita.",
        json: "data/agenda-monthly.json",
        mode: "group",
        group: "exhibitions"
      },
      cartelera: {
        title: "Obras destacadas",
        deck: "Teatro en cartel: propuestas con criterio para este mes.",
        json: "data/agenda-monthly.json",
        mode: "group",
        group: "theatre"
      },
      museo: {
        title: "Horarios de museos",
        deck: "Horarios, días clave y notas útiles para planificar.",
        json: "data/museums.json",
        mode: "items"
      },
      alarga: {
        title: "Para alargar el paseo",
        deck: "Mercados, mesas y barras para seguir con Madrid a otro ritmo.",
        json: "data/leisure.json",
        mode: "items"
      }
    };

    function openModal(){
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      kList.innerHTML = '';
    }

    document.querySelectorAll('[data-close]').forEach(el => el.addEventListener('click', closeModal));
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && modal.classList.contains('is-open')) closeModal();
    });

    function fmtDate(d){
      try {
        return new Date(d).toLocaleDateString('es-ES', { year:'numeric', month:'short', day:'2-digit' });
      } catch { return "—"; }
    }
    function fmtWhen(start){
      if(!start) return "";
      try {
        return new Date(start).toLocaleString('es-ES', { weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' });
      } catch { return ""; }
    }

    function renderItems(items){
      const max = Math.min(items.length, 8);
      if(!max){
        kList.innerHTML = '<p class="k-empty">Ahora mismo no hay recomendaciones publicadas. Vuelve pronto.</p>';
        return;
      }
      kList.innerHTML = items.slice(0, max).map(it => {
        const place = [it.venue, it.area].filter(Boolean).join(' · ');
        const when  = fmtWhen(it.start);
        const meta  = [place, when].filter(Boolean).join(' · ');
        const desc  = it.excerpt ? it.excerpt : meta;
        return `
          <div class="k-item">
            <h4>${it.title || "—"}</h4>
            <p>${desc || ""}</p>
            ${it.url ? `<a href="${it.url}" target="_blank" rel="noopener">Ver detalles →</a>` : ``}
          </div>
        `;
      }).join('');
    }

    async function loadAndRender(key){
      const cfg = CFG[key];
      kTitle.textContent = cfg.title;
      kDeck.textContent  = cfg.deck;
      kMeta.textContent  = 'Cargando…';
      kList.innerHTML = '';
      openModal();

      try{
        const res = await fetch(cfg.json, { cache: 'no-store' });
        if(!res.ok) throw new Error("fetch failed");
        const data = await res.json();

        const updated = data.updatedAt ? fmtDate(data.updatedAt) : "—";
        kMeta.textContent = `Actualizado: ${updated}`;

        if(cfg.mode === "items"){
          renderItems(Array.isArray(data.items) ? data.items : []);
          return;
        }

        if(cfg.mode === "group"){
          const groups = Array.isArray(data.groups) ? data.groups : [];
          const g = groups.find(x => x.category === cfg.group);
          if(g?.deck) kDeck.textContent = g.deck;
          renderItems(Array.isArray(g?.items) ? g.items : []);
          return;
        }

        kList.innerHTML = '<p class="k-empty">No hay datos disponibles.</p>';
      }catch(err){
        kMeta.textContent = 'No se pudo cargar la información.';
        kList.innerHTML = '<p class="k-empty">Cuando subas los JSON en /data, este overlay se llenará automáticamente.</p>';
      }
    }

    document.querySelectorAll('.k-card').forEach(btn => {
      btn.addEventListener('click', () => loadAndRender(btn.dataset.open));
    });
  </script>

</body>
</html>
